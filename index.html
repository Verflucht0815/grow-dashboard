<!-- ‚ö†Ô∏è Dieser Code ist sehr lang ‚Äì bei Bedarf aufteilen in eigene .js/.css Dateien -->
<!DOCTYPE html>
<html>
<head>
    <title>üå± GrowController Pro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>
    <style>
        :root {
            --bg-color: #f3f6f3;
            --text-color: #1c1f1a;
            --card-bg: #ffffff;
            --btn-bg: #2f6b3e;
            --btn-hover-bg: #3e8c4d;
            --btn-text: #ffffff;
            --vpd-optimal: #4caf50;
            --vpd-high: #ffc107;
            --vpd-low: #2196f3;
            --dropdown-bg: #ffffff;
            --dropdown-border: #cfd8dc;
            --nav-bg: #d9eadd;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #0f1b13;
                --text-color: #e8f5e9;
                --card-bg: #1a2b20;
                --btn-bg: #3e8c4d;
                --btn-hover-bg: #50a75e;
                --btn-text: #ffffff;
                --dropdown-bg: #243527;
                --dropdown-border: #4a5f4c;
                --nav-bg: #16251c;
                --shadow: 0 2px 8px rgba(255, 255, 255, 0.05);
            }
        }

        body {
            font-family: "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
        }

        .main-nav {
            background-color: var(--nav-bg);
            display: flex;
            justify-content: center;
            padding: 16px;
            border-bottom: 1px solid var(--dropdown-border);
            box-shadow: var(--shadow);
        }

        .main-btn {
            background-color: var(--btn-bg);
            color: var(--btn-text);
            border: none;
            padding: 12px 20px;
            margin: 0 8px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s, transform 0.2s;
            opacity: 0.9;
        }

        .main-btn:hover {
            background-color: var(--btn-hover-bg);
            transform: scale(1.05);
            opacity: 1;
        }

        .sub-nav {
            background-color: var(--nav-bg);
            padding: 12px 20px;
            display: flex;
            gap: 12px;
            border-bottom: 1px solid var(--dropdown-border);
            box-shadow: var(--shadow);
        }

        .nav-btn {
            background-color: var(--btn-bg);
            color: var(--btn-text);
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }

        .nav-btn:hover {
            background-color: var(--btn-hover-bg);
        }

        .module, .sub-module, .guide-section {
            display: none;
            padding: 24px;
        }

        .module.active, .sub-module.active, .guide-section.active {
            display: block;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
        }

        h2, h3 {
            margin-top: 0;
        }

        .guide-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .guide-btn {
            background-color: var(--btn-bg);
            color: var(--btn-text);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }

        .guide-btn:hover {
            background-color: var(--btn-hover-bg);
        }

        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
        }

        select {
            background-color: var(--dropdown-bg);
            color: var(--text-color);
            border: 1px solid var(--dropdown-border);
            border-radius: 5px;
            padding: 6px 12px;
            font-size: 14px;
        }

        .vpd-value {
            font-weight: 600;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            margin: 16px 0;
            background-color: var(--btn-bg);
            color: var(--btn-text);
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="main-nav">
        <button class="main-btn" data-main="climate">Klima</button>
        <button class="main-btn" data-main="control">Steuerung</button>
        <button class="main-btn" data-main="guide">Anleitung</button>
    </div>

    <!-- Klima-Modul -->
    <div id="climate" class="module active">
        <div class="sub-nav">
            <button class="nav-btn" data-sub="temp">Temperatur</button>
            <button class="nav-btn" data-sub="humidity">Luftfeuchtigkeit</button>
            <button class="nav-btn" data-sub="vpd">VPD</button>
        </div>

        <div id="temp" class="sub-module active">
            <div class="card">
                <h2>Temperatur (¬∞C)</h2>
                <select class="time-select" data-target="temp"> 
                    <option value="1">1h</option>
                    <option value="6">6h</option>
                    <option value="24" selected>24h</option>
                    <option value="168">7d</option>
                </select>
                <div class="chart-container"><canvas id="tempChart"></canvas></div>
            </div>
        </div>

        <div id="humidity" class="sub-module">
            <div class="card">
                <h2>Luftfeuchtigkeit (%)</h2>
                <select class="time-select" data-target="humidity"> 
                    <option value="1">1h</option>
                    <option value="6">6h</option>
                    <option value="24" selected>24h</option>
                    <option value="168">7d</option>
                </select>
                <div class="chart-container"><canvas id="humidityChart"></canvas></div>
            </div>
        </div>

        <div id="vpd" class="sub-module">
            <div class="card">
                <h2>VPD (kPa)</h2>
                <select class="time-select" data-target="vpd"> 
                    <option value="1">1h</option>
                    <option value="6">6h</option>
                    <option value="24" selected>24h</option>
                    <option value="168">7d</option>
                </select>
                <div class="chart-container"><canvas id="vpdChart"></canvas></div>
                <div id="currentVpd" class="vpd-value">Aktueller VPD: -- kPa</div>
            </div>
        </div>
    </div>

    <!-- Steuerung -->
    <div id="control" class="module">
        <div class="card">
            <h2>Steuerung</h2>
            <button class="main-btn">üí° Licht An/Aus</button>
            <button class="main-btn">üíß Wasserpumpe</button>
            <button class="main-btn">üå´Ô∏è Luftbefeuchter</button>
        </div>
    </div>

    <!-- Anleitung -->
    <div id="guide" class="module">
        <div class="card">
            <h2>Anleitung</h2>
            <div class="guide-nav">
                <button class="guide-btn" data-guide="erde">Erde</button>
                <button class="guide-btn" data-guide="wasser">Wasser</button>
                <button class="guide-btn" data-guide="duenger">D√ºnger</button>
                <button class="guide-btn" data-guide="ph">pH-Wert</button>
                <button class="guide-btn" data-guide="ecppm">EC / PPM</button>
                <button class="guide-btn" data-guide="licht">Licht Theorie</button>
                <button class="guide-btn" data-guide="training">Training</button>
            </div>
            <div id="erde" class="guide-section card active"><h3>Erde</h3><p>Lockere, n√§hrstoffreiche Erde w√§hlen.</p></div>
            <div id="wasser" class="guide-section card"><h3>Wasser</h3><p>Abgestanden, nicht zu kalt. Staun√§sse vermeiden.</p></div>
            <div id="duenger" class="guide-section card"><h3>D√ºnger</h3><p>An Wachstumsphase angepasst dosieren.</p></div>
            <div id="ph" class="guide-section card"><h3>pH-Wert</h3><p>Optimal: 5.8‚Äì6.5. Kontrollieren & anpassen.</p></div>
            <div id="ecppm" class="guide-section card"><h3>EC / PPM</h3><p>Misst N√§hrstoffkonzentration im Gie√üwasser.</p></div>
            <div id="licht" class="guide-section card"><h3>Licht Theorie</h3><p>DLI, Lumen, PAR verstehen. LED empfohlen.</p></div>
            <div id="training" class="guide-section card"><h3>Training</h3><p>LST, Topping, ScrOG f√ºr Ertragskontrolle.</p></div>
        </div>
    </div>

    <script>
    const CHANNEL_ID = 2999714;
    const READ_API_KEY = '95YOHGB903ET32DX';
    let tempChart, humidityChart, vpdChart;

    function calculateVPD(temp, humidity) {
        const svp = 0.61078 * Math.exp((17.27 * temp) / (temp + 237.3));
        const vp = svp * (humidity / 100);
        return (svp - vp).toFixed(2);
    }

    function getChartColors() {
        return {
            textColor: getComputedStyle(document.documentElement).getPropertyValue('--text-color'),
            gridColor: window.matchMedia('(prefers-color-scheme: dark)').matches ?
                'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)',
            tempColor: '#FF6384',
            humidityColor: '#36A2EB',
            vpdColor: '#9C27B0'
        };
    }

    function getChartConfig(label, unit, color, colors) {
        return {
            type: 'line',
            data: { datasets: [{ label, borderColor: color, backgroundColor: color + '20', data: [] }] },
            options: {
                responsive: true,
                scales: {
                    x: { type: 'time', time: { unit: 'hour' }, grid: { color: colors.gridColor }, ticks: { color: colors.textColor } },
                    y: { title: { display: true, text: unit, color: colors.textColor }, grid: { color: colors.gridColor }, ticks: { color: colors.textColor } }
                },
                plugins: { legend: { display: false } }
            }
        };
    }

    async function loadData(chart, hours, field) {
        const url = `https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${READ_API_KEY}&results=${hours * 6}`;
        const res = await fetch(url);
        const data = await res.json();
        const feeds = data.feeds.map(f => ({
            x: f.created_at,
            temp: parseFloat(f.field1),
            humidity: parseFloat(f.field2),
            vpd: calculateVPD(parseFloat(f.field1), parseFloat(f.field2))
        })).filter(f => !isNaN(f.temp) && !isNaN(f.humidity));

        if (chart === tempChart) chart.data.datasets[0].data = feeds.map(f => ({ x: f.x, y: f.temp }));
        if (chart === humidityChart) chart.data.datasets[0].data = feeds.map(f => ({ x: f.x, y: f.humidity }));
        if (chart === vpdChart) {
            chart.data.datasets[0].data = feeds.map(f => ({ x: f.x, y: f.vpd }));
            const vpd = feeds.at(-1)?.vpd || "--";
            const el = document.getElementById("currentVpd");
            el.textContent = `Aktueller VPD: ${vpd} kPa`;
            el.style.background = vpd < 0.8 ? "var(--vpd-low)" : (vpd > 1.2 ? "var(--vpd-high)" : "var(--vpd-optimal)");
        }

        chart.options.scales.x.time.unit = hours >= 24 ? "day" : "hour";
        chart.update();
    }

    document.addEventListener('DOMContentLoaded', () => {
        const colors = getChartColors();
        tempChart = new Chart(document.getElementById("tempChart").getContext("2d"), getChartConfig("Temperatur", "¬∞C", colors.tempColor, colors));
        humidityChart = new Chart(document.getElementById("humidityChart").getContext("2d"), getChartConfig("Luftfeuchtigkeit", "%", colors.humidityColor, colors));
        vpdChart = new Chart(document.getElementById("vpdChart").getContext("2d"), getChartConfig("VPD", "kPa", colors.vpdColor, colors));

        document.querySelectorAll('.time-select').forEach(select => {
            select.addEventListener('change', function () {
                const val = parseInt(this.value);
                const target = this.dataset.target;
                if (target === 'temp') loadData(tempChart, val);
                if (target === 'humidity') loadData(humidityChart, val);
                if (target === 'vpd') loadData(vpdChart, val);
            });
            select.dispatchEvent(new Event('change'));
        });

        document.querySelectorAll('.main-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.module').forEach(m => m.classList.remove('active'));
                document.getElementById(btn.dataset.main).classList.add('active');
            });
        });

        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.sub-module').forEach(m => m.classList.remove('active'));
                document.getElementById(btn.dataset.sub).classList.add('active');
            });
        });

        document.querySelectorAll('.guide-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.guide-section').forEach(s => s.classList.remove('active'));
                document.getElementById(btn.dataset.guide).classList.add('active');
            });
        });
    });
    </script>
</body>
</html>
