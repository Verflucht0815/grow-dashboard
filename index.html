<!DOCTYPE html>
<html>
<head>
    <title>ðŸŒ± GrowController</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>
    <style>
        :root {
            --bg-color: #f5f5f5;
            --text-color: #333;
            --card-bg: white;
            --btn-bg: #4CAF50;
            --btn-text: white;
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #121212;
                --text-color: #f5f5f5;
                --card-bg: #1e1e1e;
                --btn-bg: #2E7D32;
            }
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 10px;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .time-btn {
            background-color: var(--btn-bg);
            color: var(--btn-text);
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .chart-container {
            position: relative;
            width: 100%;
            min-height: 250px;
        }
        
        @media (min-width: 768px) {
            .chart-container {
                min-height: 350px;
            }
            
            .card {
                padding: 20px;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <h1>ðŸŒ± GrowController</h1>
    
    <div class="btn-container">
        <button class="time-btn">1h</button>
        <button class="time-btn">6h</button>
        <button class="time-btn">12h</button>
        <button class="time-btn">24h</button>
        <button class="time-btn">7d</button>
        <button class="time-btn">14d</button>
        <button class="time-btn">30d</button>
    </div>
    
    <div class="card">
        <h2>Temperatur (Â°C)</h2>
        <div class="chart-container">
            <canvas id="tempChart"></canvas>
        </div>
    </div>
    
    <div class="card">
        <h2>Luftfeuchtigkeit (%)</h2>
        <div class="chart-container">
            <canvas id="humidityChart"></canvas>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Konfiguration
        const CHANNEL_ID = 2999714;
        const READ_API_KEY = '95YOHGB903ET32DX';
        let tempChart, humidityChart;
        
        // Farben fÃ¼r Dark/Light Mode
        const getChartColors = () => {
            return {
                textColor: getComputedStyle(document.documentElement).getPropertyValue('--text-color'),
                gridColor: window.matchMedia('(prefers-color-scheme: dark)').matches ? 
                          'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)',
                tempColor: '#FF6384',
                humidityColor: '#36A2EB'
            };
        };
        
        // Diagramme initialisieren
        function initCharts() {
            const colors = getChartColors();
            
            // Temperatur-Chart
            const tempCtx = document.getElementById('tempChart').getContext('2d');
            tempChart = new Chart(tempCtx, {
                type: 'line',
                data: { datasets: [{ 
                    label: "Temperatur", 
                    borderColor: colors.tempColor,
                    backgroundColor: colors.tempColor + '20',
                    borderWidth: 2,
                    pointRadius: 0,
                    data: [] 
                }]},
                options: getChartOptions('Â°C', colors)
            });
            
            // Luftfeuchtigkeits-Chart
            const humidityCtx = document.getElementById('humidityChart').getContext('2d');
            humidityChart = new Chart(humidityCtx, {
                type: 'line',
                data: { datasets: [{ 
                    label: "Luftfeuchtigkeit", 
                    borderColor: colors.humidityColor,
                    backgroundColor: colors.humidityColor + '20',
                    borderWidth: 2,
                    pointRadius: 0,
                    data: [] 
                }]},
                options: getChartOptions('%', colors)
            });
        }
        
        // Gemeinsame Chart-Optionen
        function getChartOptions(unit, colors) {
            return {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { 
                        type: 'time',
                        time: {
                            tooltipFormat: 'DD.MM HH:mm',
                            unit: 'hour'
                        },
                        grid: { color: colors.gridColor },
                        ticks: { color: colors.textColor }
                    },
                    y: { 
                        title: { 
                            display: true, 
                            text: unit,
                            color: colors.textColor
                        },
                        grid: { color: colors.gridColor },
                        ticks: { color: colors.textColor }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        displayColors: true
                    }
                },
                interaction: {
                    mode: 'nearest',
                    axis: 'x',
                    intersect: false
                }
            };
        }
        
        // Daten laden
        async function loadData(hours) {
            try {
                const response = await fetch(
                    `https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${READ_API_KEY}&results=${hours*6}`
                );
                const data = await response.json();
                
                // Daten aktualisieren
                tempChart.data.datasets[0].data = data.feeds.map(f => ({
                    x: f.created_at,
                    y: parseFloat(f.field1)
                }));
                
                humidityChart.data.datasets[0].data = data.feeds.map(f => ({
                    x: f.created_at,
                    y: parseFloat(f.field2)
                }));
                
                // Zeitachse anpassen
                const timeUnit = hours >= 24 ? 'day' : 'hour';
                tempChart.options.scales.x.time.unit = timeUnit;
                humidityChart.options.scales.x.time.unit = timeUnit;
                
                // Aktualisieren
                tempChart.update();
                humidityChart.update();
            } catch (error) {
                console.error("Fehler:", error);
            }
        }
        
        // Event-Listener fÃ¼r Buttons
        document.querySelectorAll('.time-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // Aktiven Button markieren
                document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // Stunden berechnen (1h, 6h, 24h, 7d)
                const text = btn.textContent;
                const hours = text.includes('d') ? 
                    parseInt(text) * 24 : 
                    parseInt(text);
                
                loadData(hours);
            });
        });
        
        // Dark Mode Ã„nderungen Ã¼berwachen
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
            const colors = getChartColors();
            
            [tempChart, humidityChart].forEach(chart => {
                chart.options.scales.x.ticks.color = colors.textColor;
                chart.options.scales.y.ticks.color = colors.textColor;
                chart.options.scales.y.title.color = colors.textColor;
                chart.options.scales.x.grid.color = colors.gridColor;
                chart.options.scales.y.grid.color = colors.gridColor;
                chart.update();
            });
        });
        
        // Initialisierung
        initCharts();
        document.querySelector('.time-btn:nth-child(3)').click(); // Start mit 24h
    });
    </script>
</body>
</html>
