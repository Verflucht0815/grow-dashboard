<!DOCTYPE html>
<html>
<head>
    <title>üå± GrowController Pro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>
    <style>
        :root {
            --bg-color: #f2f3f5;
            --text-color: #1e1e1e;
            --card-bg: #ffffff;
            --btn-bg: #1f2937;
            --btn-hover-bg: #374151;
            --btn-text: #ffffff;
            --vpd-optimal: #16a34a;
            --vpd-high: #eab308;
            --vpd-low: #0ea5e9;
            --dropdown-bg: #ffffff;
            --dropdown-border: #cbd5e1;
            --nav-bg: #e5e7eb;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #111827;
                --text-color: #e5e7eb;
                --card-bg: #1f2937;
                --btn-bg: #374151;
                --btn-hover-bg: #4b5563;
                --btn-text: #ffffff;
                --dropdown-bg: #1e293b;
                --dropdown-border: #334155;
                --nav-bg: #1a1f2b;
                --shadow: 0 2px 8px rgba(255, 255, 255, 0.05);
            }
        }

        body {
            font-family: "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
        }

        .nav-menu {
            background-color: var(--nav-bg);
            padding: 12px 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            border-bottom: 1px solid var(--dropdown-border);
            box-shadow: var(--shadow);
        }

        .nav-btn {
            background-color: var(--btn-bg);
            color: var(--btn-text);
            border: none;
            padding: 10px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s, transform 0.2s;
            opacity: 0.85;
        }

        .nav-btn:hover {
            background-color: var(--btn-hover-bg);
            transform: scale(1.02);
            opacity: 1;
        }

        .module {
            display: none;
            padding: 24px;
        }

        .module.active {
            display: block;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
        }

        select {
            background-color: var(--dropdown-bg);
            color: var(--text-color);
            border: 1px solid var(--dropdown-border);
            border-radius: 5px;
            padding: 6px 12px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        select:focus {
            border-color: var(--btn-bg);
            outline: none;
        }

        .chart-container {
            position: relative;
            width: 100%;
            min-height: 280px;
            margin-bottom: 10px;
        }

        .info-dropdown {
            margin-top: 18px;
        }

        .info-btn {
            background-color: var(--btn-bg);
            color: var(--btn-text);
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
            transition: background 0.3s;
        }

        .info-btn:hover {
            background-color: var(--btn-hover-bg);
        }

        .info-btn::after {
            content: "‚ñº";
            font-size: 12px;
            transition: transform 0.3s;
        }

        .info-btn.active::after {
            transform: rotate(180deg);
        }

        .info-content {
            display: none;
            padding: 14px;
            background-color: var(--card-bg);
            border-radius: 0 0 6px 6px;
            border: 1px solid var(--dropdown-border);
            border-top: none;
            margin-top: -1px;
        }

        .vpd-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
            font-size: 14px;
        }

        .vpd-table th,
        .vpd-table td {
            border: 1px solid var(--text-color);
            padding: 8px;
            text-align: center;
        }

        .vpd-table th {
            background-color: var(--btn-bg);
            color: var(--btn-text);
        }

        .vpd-value {
            font-weight: 600;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            margin: 16px 0;
            background-color: var(--btn-bg);
            color: var(--btn-text);
            font-size: 16px;
        }

        @media (min-width: 768px) {
            .chart-container {
                min-height: 350px;
            }

            .card {
                padding: 24px 28px;
            }

            .nav-menu {
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="nav-menu">
        <button class="nav-btn" data-module="temp">Temperatur</button>
        <button class="nav-btn" data-module="humidity">Luftfeuchtigkeit</button>
        <button class="nav-btn" data-module="vpd">VPD</button>
    </div>
    
    <!-- Temperatur Modul -->
    <div id="temp-module" class="module">
        <div class="card">
            <div class="chart-header">
                <h2>Temperatur (¬∞C)</h2>
                <select class="time-select">
                    <option value="1">1 Stunde</option>
                    <option value="6">6 Stunden</option>
                    <option value="24" selected>24 Stunden</option>
                    <option value="168">7 Tage</option>
                    <option value="720">30 Tage</option>
                </select>
            </div>
            <div class="chart-container">
                <canvas id="tempChart"></canvas>
            </div>
            <div class="info-dropdown">
                <button class="info-btn">‚ÑπÔ∏è Optimale Temperaturwerte</button>
                <div class="info-content">
                    <ul>
                        <li><strong>Keimling:</strong> 20-25¬∞C</li>
                        <li><strong>Wachstum:</strong> 22-28¬∞C (Tag), 18-22¬∞C (Nacht)</li>
                        <li><strong>Bl√ºte:</strong> 20-26¬∞C (Tag), 18-21¬∞C (Nacht)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Luftfeuchtigkeit Modul -->
    <div id="humidity-module" class="module">
        <div class="card">
            <div class="chart-header">
                <h2>Luftfeuchtigkeit (%)</h2>
                <select class="time-select">
                    <option value="1">1 Stunde</option>
                    <option value="6">6 Stunden</option>
                    <option value="24" selected>24 Stunden</option>
                    <option value="168">7 Tage</option>
                    <option value="720">30 Tage</option>
                </select>
            </div>
            <div class="chart-container">
                <canvas id="humidityChart"></canvas>
            </div>
            <div class="info-dropdown">
                <button class="info-btn">‚ÑπÔ∏è Optimale Luftfeuchtigkeit</button>
                <div class="info-content">
                    <ul>
                        <li><strong>Keimling:</strong> 65-70%</li>
                        <li><strong>Wachstum:</strong> 40-70%</li>
                        <li><strong>Bl√ºte:</strong> 40-50% (Schimmelpr√§vention)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- VPD Modul -->
    <div id="vpd-module" class="module">
        <div class="card">
            <div class="chart-header">
                <h2>VPD (kPa)</h2>
                <select class="time-select">
                    <option value="1">1 Stunde</option>
                    <option value="6">6 Stunden</option>
                    <option value="24" selected>24 Stunden</option>
                    <option value="168">7 Tage</option>
                    <option value="720">30 Tage</option>
                </select>
            </div>
            <div class="chart-container">
                <canvas id="vpdChart"></canvas>
            </div>
            <div id="currentVpd" class="vpd-value">Aktueller VPD: -- kPa</div>
            <div class="info-dropdown">
                <button class="info-btn">‚ÑπÔ∏è VPD-Informationen</button>
                <div class="info-content">
                    <p><strong>Optimalbereiche:</strong></p>
                    <ul>
                        <li><strong>Keimling:</strong> 0.4-0.8 kPa</li>
                        <li><strong>Wachstum:</strong> 0.8-1.2 kPa</li>
                        <li><strong>Bl√ºte:</strong> 1.0-1.5 kPa</li>
                    </ul>
                    
                    <h4>VPD-Referenztabelle</h4>
                    <table class="vpd-table">
                        <thead>
                            <tr>
                                <th>Temp (¬∞C)</th>
                                <th>40% RH</th>
                                <th>50% RH</th>
                                <th>60% RH</th>
                                <th>70% RH</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>20</td>
                                <td>0.93</td>
                                <td>0.70</td>
                                <td>0.47</td>
                                <td>0.23</td>
                            </tr>
                            <tr>
                                <td>22</td>
                                <td>1.05</td>
                                <td>0.81</td>
                                <td>0.57</td>
                                <td>0.33</td>
                            </tr>
                            <tr>
                                <td>24</td>
                                <td>1.19</td>
                                <td>0.93</td>
                                <td>0.68</td>
                                <td>0.42</td>
                            </tr>
                            <tr>
                                <td>26</td>
                                <td>1.34</td>
                                <td>1.07</td>
                                <td>0.80</td>
                                <td>0.53</td>
                            </tr>
                            <tr>
                                <td>28</td>
                                <td>1.51</td>
                                <td>1.23</td>
                                <td>0.94</td>
                                <td>0.65</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Konfiguration
        const CHANNEL_ID = 2999714;
        const READ_API_KEY = '95YOHGB903ET32DX';
        let tempChart, humidityChart, vpdChart;
        
        // VPD Berechnung (in kPa)
        function calculateVPD(temp, humidity) {
            if (!temp || !humidity) return null;
            
            // S√§ttigungsdampfdruck (Tetens-Formel)
            const svp = 0.61078 * Math.exp((17.27 * temp) / (temp + 237.3));
            
            // Tats√§chlicher Dampfdruck
            const vp = svp * (humidity / 100);
            
            // VPD in kPa
            return (svp - vp).toFixed(2);
        }
        
        // Farben f√ºr Dark/Light Mode
        const getChartColors = () => {
            return {
                textColor: getComputedStyle(document.documentElement).getPropertyValue('--text-color'),
                gridColor: window.matchMedia('(prefers-color-scheme: dark)').matches ? 
                          'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)',
                tempColor: '#FF6384',
                humidityColor: '#36A2EB',
                vpdColor: '#9C27B0'
            };
        };
        
        // Diagramme initialisieren
        function initCharts() {
            const colors = getChartColors();
            
            // Temperatur-Chart
            tempChart = new Chart(
                document.getElementById('tempChart').getContext('2d'), 
                getChartConfig('Temperatur', '¬∞C', colors.tempColor, colors)
            );
            
            // Luftfeuchtigkeits-Chart
            humidityChart = new Chart(
                document.getElementById('humidityChart').getContext('2d'), 
                getChartConfig('Luftfeuchtigkeit', '%', colors.humidityColor, colors)
            );
            
            // VPD-Chart
            vpdChart = new Chart(
                document.getElementById('vpdChart').getContext('2d'), 
                getChartConfig('VPD', 'kPa', colors.vpdColor, colors)
            );
        }
        
        // Gemeinsame Chart-Konfiguration
        function getChartConfig(label, unit, color, colors) {
            return {
                type: 'line',
                data: { 
                    datasets: [{ 
                        label: label, 
                        borderColor: color,
                        backgroundColor: color + '20',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.1,
                        data: [] 
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            type: 'time',
                            time: {
                                tooltipFormat: 'DD.MM HH:mm',
                                unit: 'hour'
                            },
                            grid: { color: colors.gridColor },
                            ticks: { color: colors.textColor }
                        },
                        y: { 
                            title: { 
                                display: true, 
                                text: unit,
                                color: colors.textColor
                            },
                            grid: { color: colors.gridColor },
                            ticks: { color: colors.textColor }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    }
                }
            };
        }
        
        // Daten laden
        async function loadData(chart, hours) {
            try {
                const response = await fetch(
                    `https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${READ_API_KEY}&results=${hours*6}`
                );
                const data = await response.json();
                
                // Daten aufbereiten
                const feeds = data.feeds.map(f => ({
                    x: f.created_at,
                    temp: parseFloat(f.field1),
                    humidity: parseFloat(f.field2),
                    vpd: calculateVPD(parseFloat(f.field1), parseFloat(f.field2))
                })).filter(f => !isNaN(f.temp) && !isNaN(f.humidity));
                
                // Chart aktualisieren
                if (chart === tempChart) {
                    chart.data.datasets[0].data = feeds.map(f => ({ x: f.x, y: f.temp }));
                } else if (chart === humidityChart) {
                    chart.data.datasets[0].data = feeds.map(f => ({ x: f.x, y: f.humidity }));
                } else if (chart === vpdChart) {
                    chart.data.datasets[0].data = feeds.map(f => ({ x: f.x, y: f.vpd }));
                    
                    // Aktuellen VPD-Wert anzeigen
                    if (feeds.length > 0) {
                        const lastVpd = feeds[feeds.length-1].vpd;
                        const vpdElement = document.getElementById('currentVpd');
                        vpdElement.textContent = `Aktueller VPD: ${lastVpd} kPa`;
                        
                        // Farbe nach VPD-Bereich
                        if (lastVpd < 0.8) {
                            vpdElement.style.background = 'var(--vpd-low)';
                        } else if (lastVpd > 1.2) {
                            vpdElement.style.background = 'var(--vpd-high)';
                        } else {
                            vpdElement.style.background = 'var(--vpd-optimal)';
                        }
                    }
                }
                
                // Zeitachse anpassen
                const timeUnit = hours >= 24 ? 'day' : 'hour';
                chart.options.scales.x.time.unit = timeUnit;
                chart.update();
                
            } catch (error) {
                console.error("Fehler:", error);
            }
        }
        
        // Event-Listener f√ºr Dropdowns
        document.querySelectorAll('.time-select').forEach(select => {
            select.addEventListener('change', function() {
                const hours = parseInt(this.value);
                const chartId = this.closest('.card').querySelector('canvas').id;
                
                switch(chartId) {
                    case 'tempChart':
                        loadData(tempChart, hours);
                        break;
                    case 'humidityChart':
                        loadData(humidityChart, hours);
                        break;
                    case 'vpdChart':
                        loadData(vpdChart, hours);
                        break;
                }
            });
        });
        
        // Event-Listener f√ºr Nav-Buttons
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const moduleId = this.dataset.module;
                
                // Alle Module verstecken
                document.querySelectorAll('.module').forEach(mod => {
                    mod.classList.remove('active');
                });
                
                // Aktives Modul anzeigen
                document.getElementById(`${moduleId}-module`).classList.add('active');
                
                // Nav-Buttons zur√ºcksetzen
                document.querySelectorAll('.nav-btn').forEach(b => {
                    b.style.opacity = '0.7';
                });
                
                // Aktiven Button markieren
                this.style.opacity = '1';
            });
        });
        
        // Event-Listener f√ºr Info-Dropdowns
        document.querySelectorAll('.info-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                this.classList.toggle('active');
                const content = this.nextElementSibling;
                content.style.display = content.style.display === 'block' ? 'none' : 'block';
            });
        });
        
        // Dark Mode √Ñnderungen √ºberwachen
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
            const colors = getChartColors();
            
            [tempChart, humidityChart, vpdChart].forEach(chart => {
                chart.options.scales.x.ticks.color = colors.textColor;
                chart.options.scales.y.ticks.color = colors.textColor;
                chart.options.scales.y.title.color = colors.textColor;
                chart.options.scales.x.grid.color = colors.gridColor;
                chart.options.scales.y.grid.color = colors.gridColor;
                chart.update();
            });
        });
        
        // Initialisierung
        initCharts();
        document.querySelector('.nav-btn[data-module="temp"]').click();
        document.querySelectorAll('.time-select').forEach(select => {
            select.dispatchEvent(new Event('change'));
        });
    });
    </script>
</body>
</html>
